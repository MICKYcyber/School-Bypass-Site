<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Lincoln's Proxy Browser</title>
<style>
html, body { margin:0; padding:0; height:100%; width:100%; overflow:hidden; font-family:"Segoe UI",Arial,sans-serif; background:#1e1e1e; color:#fff; }
#container { position:absolute; top:0; left:0; right:0; bottom:0; display:flex; flex-direction:column; }
#tabs { display:flex; background:#2c2c2c; border-bottom:1px solid #444; overflow-x:auto; white-space:nowrap; padding:0; margin:0; flex-shrink:0; }
.tab { padding:8px 8px; background:#3c3c3c; color:#ccc; cursor:pointer; border-radius:6px 6px 0 0; margin:0 2px 0 0; display:flex; align-items:center; justify-content:space-between; flex-shrink:0; min-width:50px; }
.tab.active { background:#1e1e1e; color:#fff; }
.tab .title-container { display:flex; align-items:center; overflow:hidden; gap:4px; }
.tab .favicon { width:16px; height:16px; object-fit:contain; }
.tab .closeBtn { background:#555; border:none; border-radius:50%; width:16px; height:16px; font-size:12px; color:#fff; cursor:pointer; display:flex; align-items:center; justify-content:center; padding:0; }
.tab .closeBtn:hover { background:#f44336; }
#addTab { padding:8px 16px; background:#3c3c3c; color:#ccc; cursor:pointer; border-radius:6px 6px 0 0; flex-shrink:0; margin-left:2px; display:flex; align-items:center; justify-content:center; }
#addTab:hover { background:#555; }
#toolbar { display:flex; align-items:center; padding:2px 6px; background:#2b2b2b; border-bottom:1px solid #444; flex-shrink:0; }
#search { flex:1; padding:6px 10px; font-size:14px; border:none; border-radius:20px; background:#3c3c3c; color:#fff; outline:none; }
#view { flex:1; background:#000; display:flex; flex-direction:column; overflow:hidden; }
iframe, img, embed { width:100%; height:100%; border:none; display:block; object-fit:contain; }
</style>
</head>
<body>
<div id="container">
  <div id="tabs">
    <div id="addTab">+</div>
  </div>
  <div id="toolbar">
    <input id="search" placeholder="Type URL or search and press Enter"/>
  </div>
  <div id="view"></div>
</div>
<script>
const tabsDiv = document.getElementById("tabs");
const addTabBtn = document.getElementById("addTab");
const input = document.getElementById("search");
const view = document.getElementById("view");

const PROXY_BASE = "https://prox-khzr.onrender.com/proxy?url=";
const tabs = [];
let activeTab = null;
let lastTabURL = "https://www.google.com";

function activateTab(tab){
  tabs.forEach(t=>{ t.element.style.display="none"; t.tabBtn.classList.remove("active"); });
  tab.element.style.display="block";
  tab.tabBtn.classList.add("active");
  activeTab = tab;
}

function createTab(url){
  if(!/^https?:\/\//i.test(url)) {
    url = "https://www.google.com/search?q=" + encodeURIComponent(url);
  }
  lastTabURL = url;

  let element;
  let isWebPage = true;
  let tabTitle = url;

  if(url.match(/\.(jpeg|jpg|gif|png|svg)$/i)){
    element = document.createElement("img");
    element.src = url;
    isWebPage = false;
    tabTitle = url.split('/').pop();
  } else if(url.match(/\.pdf$/i)){
    element = document.createElement("embed");
    element.src = PROXY_BASE + encodeURIComponent(url);
    isWebPage = false;
    tabTitle = url.split('/').pop();
  } else {
    element = document.createElement("iframe");
    element.src = PROXY_BASE + encodeURIComponent(url);
  }
  element.style.display="none";
  view.appendChild(element);

  const tabBtn = document.createElement("div"); tabBtn.className="tab";
  const titleContainer = document.createElement("div"); titleContainer.className="title-container";
  const favicon = document.createElement("img"); favicon.className="favicon"; favicon.src="";
  const titleSpan = document.createElement("span"); titleSpan.textContent=tabTitle;
  titleContainer.appendChild(favicon);
  titleContainer.appendChild(titleSpan);

  const closeBtn = document.createElement("button"); closeBtn.className="closeBtn"; closeBtn.textContent="Ã—";

  closeBtn.onclick = e=>{
    e.stopPropagation();
    const idx = tabs.findIndex(t=>t.tabBtn===tabBtn);
    if(idx!==-1) tabs.splice(idx,1);
    element.remove(); tabBtn.remove();
    if(tabs.length>0){
      activateTab(tabs[Math.max(0,idx-1)]);
    } else {
      createTab(lastTabURL);
    }
  };

  tabBtn.appendChild(titleContainer);
  tabBtn.appendChild(closeBtn);
  tabBtn.onclick = ()=>activateTab({element, tabBtn});
  tabsDiv.insertBefore(tabBtn, addTabBtn);

  const tab = {element, tabBtn};
  tabs.push(tab);
  activateTab(tab);

  if(isWebPage && element.tagName==="IFRAME"){
    element.onload = ()=>{
      try{
        const doc = element.contentDocument;
        if(doc?.title) titleSpan.textContent = doc.title;
        const iconLink = doc?.querySelector('link[rel~="icon"]');
        if(iconLink) favicon.src = iconLink.href;
      } catch(e){
        titleSpan.textContent = tabTitle;
      }
    }
  }
}

addTabBtn.onclick = ()=>{ createTab("https://www.google.com"); };

input.addEventListener("keypress", e=>{
  if(e.key==="Enter"){
    const val = input.value.trim();
    if(val) createTab(val);
    input.value = "";
  }
});

createTab("https://www.google.com");

function adjustViewHeight(){
  view.style.height = (window.innerHeight - document.getElementById("tabs").offsetHeight - document.getElementById("toolbar").offsetHeight) + "px";
}
adjustViewHeight();
window.addEventListener('resize', adjustViewHeight);
</script>
</body>
</html>
